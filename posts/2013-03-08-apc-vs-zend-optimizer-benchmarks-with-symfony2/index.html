<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>APC vs Zend Optimizer&#43; Benchmarks with Symfony2 - Ricard Clau</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1309891-8','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Ricard Clau" rel=home><div class="logo__item logo__text"><div class=logo__title>Ricard Clau</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about-me><span class=menu__text>About me</span></a></li><li class=menu__item><a class=menu__link href=/curriculum-vitae-en><span class=menu__text>CV</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>APC vs Zend Optimizer&#43; Benchmarks with Symfony2</h1></header><figure class="post__thumbnail thumbnail"><img class=thumbnail__image src=/wp-content/uploads/2013/03/turbo.png alt="APC vs Zend Optimizer&#43; Benchmarks with Symfony2"></figure><div class="content post__content clearfix"><p>If you are following some of the biggest names in the <strong>PHP scene</strong> you may have seen that <strong>Zend Optimizer+</strong> is now open-source on Github at <a href=https://github.com/zend-dev/ZendOptimizerPlus target=_blank><a href=https://github.com/zend-dev/ZendOptimizerPlus>https://github.com/zend-dev/ZendOptimizerPlus</a></a> and it seems that will be included in <strong>PHP 5.5</strong> distribution.</p><p>This is awesome news as we will finally get a <strong>PHP Accelerator</strong> bundled with the main language distribution and there should not be (let&#8217;s hope) weird issues like the ones happening in early versions of PHP 5.4 with APC that has prevented massive adoption of the new stable version of our favorite language.</p><p>There are some really promising performance tests available <a href="https://docs.google.com/spreadsheet/ccc?key=0Agw0hgqCxf0cdEZsdm1yNjd3amJReG05MzJYSF9USGc#gid=0" target=_blank>here</a> but at the time of writing this post there are neither <strong>Symfony2</strong> nor <strong>Zend Framework 2</strong> benchmarks so I decided to grab the extension and do my own performance tests.</p><p>So&hellip; let&#8217;s see the results</p><h3 id=hardware-and-software-used>Hardware and software used</h3><p>What is tested? Basically the simplest application you can develop with Symfony2 (Version 2.2.0).<br>Composer was run with -o flag which, as you should know, optimizes autoload creating a classmap (except the test which is said that it war ran without it)</p><p>Machine used is my laptop, basically a Macbook Air with 1.8 Ghz i5 processor, 8Gb RAM and SSD HD</p><p>PHP version is 5.4.12, APC is 3.1.13 and OS is MacOSx Mountain Lion</p><p>And the tests are run with Apache Benchmark against a Macports default Apache installation with these settings:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">1</span>ab -n <span style=color:#ae81ff>5000</span> -c <span style=color:#ae81ff>10</span> &lt;symfony2_url&gt;</code></pre></div><h3 id=a-symfony2-hello-world>A Symfony2 Hello world</h3><p>I&#8217;ve seen some &#8220;Hello world&#8221; performance tests around the Internet using Twig but I guess the fairest test for a Symfony2 minimal footprint is some controller like this one:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 1</span><span style=color:#75715e>&lt;?php</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 2</span> 
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 3</span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>RicardClau\Bundle\BenchmarkBundle\Controller</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 4</span> 
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 5</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Bundle\FrameworkBundle\Controller\Controller</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 6</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Sensio\Bundle\FrameworkExtraBundle\Configuration\Route</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 7</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Sensio\Bundle\FrameworkExtraBundle\Configuration\Template</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 8</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\HttpFoundation\Response</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 9</span> 
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">10</span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DefaultController</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Controller</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">11</span>{
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">12</span>    <span style=color:#e6db74>/**
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">13</span><span style=color:#e6db74>     * @Route(&#34;/benchmark&#34;, name=&#34;benchmark&#34;)
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">14</span><span style=color:#e6db74>     * @return \Symfony\Component\HttpFoundation\Response
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">15</span><span style=color:#e6db74>     */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">16</span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>benchmarkAction</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">17</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">18</span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>&#39;APC vs ZO+&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">19</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">20</span>}
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">21</span> 
</code></pre></div><h3 id=results-with-xdebug>Results with Xdebug</h3><h4 id=php-5-4-12-without-apc-but-with-composer-optimization>PHP 5.4.12 without APC, but with composer optimization</h4><p>~ 37 req / s (really poor performance)</p><h4 id=php-5-4-12-with-apc-3-1-13-no-custom-but-without-composer-autoload-optimization>PHP 5.4.12 with APC 3.1.13 no custom, but without composer autoload optimization</h4><p>~ 155 req / s</p><h4 id=php-5-4-12-with-apc-3-1-13-no-custom>PHP 5.4.12 with APC 3.1.13 no custom</h4><p>~ 180 req / s (nice boost with composer autoload optimization!)</p><h4 id=php-5-4-12-with-apc-3-1-13-and-apc-stat-off>PHP 5.4.12 with APC 3.1.13 and apc.stat = Off</h4><p>~ 195 req / s</p><h4 id=php-5-4-12-with-apc-3-1-13-apc-universal-classloader-and-apc-stat-off>PHP 5.4.12 with APC 3.1.13, APC Universal ClassLoader and apc.stat = Off</h4><p>~ 195 req / s (almost same performance if you use composer autoload optimizer and stat is set to off)</p><h4 id=php-5-4-12-with-zend-optimizer-no-custom>PHP 5.4.12 with Zend Optimizer+ no custom</h4><p>~ 211 req / s</p><h4 id=php-5-4-12-with-zend-optimizer-recommended-settings>PHP 5.4.12 with Zend Optimizer+ recommended settings</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">1</span>  zend_optimizerplus.memory_consumption<span style=color:#f92672>=</span><span style=color:#ae81ff>128</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">2</span>  zend_optimizerplus.interned_strings_buffer<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">3</span>  zend_optimizerplus.max_accelerated_files<span style=color:#f92672>=</span><span style=color:#ae81ff>4000</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">4</span>  zend_optimizerplus.revalidate_freq<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">5</span>  zend_optimizerplus.fast_shutdown<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">6</span>  zend_optimizerplus.enable_cli<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span></code></pre></div><p>~ 220 req / s</p><h4 id=php-5-4-12-with-zend-optimizer-extreme-settings>PHP 5.4.12 with Zend Optimizer+ extreme settings</h4><p>All of the above plus</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">1</span>  zend_optimizerplus.save_comments<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>&lt;br /&gt;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">2</span>  zend_optimizerplus.enable_file_override<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span></code></pre></div><p>~ 202 req / s (which is really weird to be lower actually but I&rsquo;ve tested it many times and seems to happen in my setup)</p><p>Please note that to make this last test work properly, you should have your Symfony2 cache warmed before the test if you are using annotations. Otherwise these settings will make your annotations get ignored!</p><h3 id=results-without-xdebug>Results WITHOUT Xdebug</h3><p>(thx to @pborreli suggestion)</p><h4 id=php-5-4-12-without-apc-but-with-composer-optimization-1>PHP 5.4.12 without APC, but with composer optimization</h4><p>~ 40 req / s (really poor performance)</p><h4 id=php-5-4-12-with-apc-3-1-13-no-custom-but-without-composer-autoload-optimization-1>PHP 5.4.12 with APC 3.1.13 no custom, but without composer autoload optimization</h4><p>~ 249 req / s</p><h4 id=php-5-4-12-with-apc-3-1-13-no-custom-1>PHP 5.4.12 with APC 3.1.13 no custom</h4><p>~ 260 req / s (nice boost with composer autoload optimization but less impressive than before!)</p><h4 id=php-5-4-12-with-apc-3-1-13-and-apc-stat-off-1>PHP 5.4.12 with APC 3.1.13 and apc.stat = Off</h4><p>~ 280 req / s (still nice boost)</p><h4 id=php-5-4-12-with-apc-3-1-13-apc-universal-classloader-and-apc-stat-off-1>PHP 5.4.12 with APC 3.1.13, APC Universal ClassLoader and apc.stat = Off</h4><p>~ 280 req / s (almost same performance again if you use composer autoload optimizer and stat is set to off)</p><h4 id=php-5-4-12-with-zend-optimizer-no-custom-1>PHP 5.4.12 with Zend Optimizer+ no custom</h4><p>~ 307 req / s</p><h4 id=php-5-4-12-with-zend-optimizer-recommended-settings-1>PHP 5.4.12 with Zend Optimizer+ recommended settings</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">1</span>  zend_optimizerplus.memory_consumption<span style=color:#f92672>=</span><span style=color:#ae81ff>128</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">2</span>  zend_optimizerplus.interned_strings_buffer<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">3</span>  zend_optimizerplus.max_accelerated_files<span style=color:#f92672>=</span><span style=color:#ae81ff>4000</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">4</span>  zend_optimizerplus.revalidate_freq<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">5</span>  zend_optimizerplus.fast_shutdown<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">6</span>  zend_optimizerplus.enable_cli<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span></code></pre></div><p>~ 337 req / s</p><h4 id=php-5-4-12-with-zend-optimizer-extreme-settings-1>PHP 5.4.12 with Zend Optimizer+ extreme settings</h4><p>All of the above plus</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">1</span>  zend_optimizerplus.save_comments<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">2</span>  zend_optimizerplus.enable_file_override<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span></code></pre></div><p>~ 312 req / s (again slower)</p><h3 id=some-excel-graphics>Some Excel graphics</h3><figure><img src=/wp-content/uploads/2013/03/comparisonapczoplus.png></figure><h3 id=conclusions>Conclusions</h3><p>First of all, I would like to say that these results must be taken with a pinch of salt as they were made in my personal laptop which <strong>is NOT a production server</strong>. Operating System is <strong>MacOSx</strong> so they might differ a little bit on a <strong>Linux</strong> machine prepared for production.
Having said that, there are some interesting facts:</p><ul><li>With APC, Symfony2 performance is dramatically boosted!. What would we do without PHP Accelerators? Thus, the importance of having an <strong>accelerator bundled with the standard distribution</strong></li><li>With <strong>composer autoload optimization</strong> we might get a benefit of ~20-25% even with a small test like this. Don&rsquo;t forget it in your production environments!. However, disabling xDebug made this benefit get reduced to ~10%.</li><li>With <strong>apc.stat set to Off</strong>, we get an extra boost of ~8-10% even in such a small test. This gets bigger when the amount of files opened increases. Don&rsquo;t forget to consider it. However, remember that whenever a change is uploaded you should reset APC so that your changes are noticed.</li><li><strong>Xdebug</strong> make things SLOW. However, most of the % are similar, except maybe the performance boost with composer autoloader optimizer. Please check that you have not it enabled in your production servers!</li><li><strong>Zend Optimizer+ is faster than APC</strong>, even with the default installation. With recommended settings and in the best scenario we get our requests to be 10 times faster than PHP with no Accelerator!</li><li>With <strong>recommended settings</strong> we get a performance boost of ~11% with xDebug and of ~15% without it, if we compare with APC best performance, but there seems to be something wrong with the extreme settings which were getting worse performance. This was consistent in 5 test I did in different moments, so it seems we can discard that there might have been some background process consuming CPU.</li><li>Is it <strong>worth to switch</strong>? Well, it depends, at least at the moment of writing these lines. If you are not using APC as a local storage cache, it seems that you will get an extra boost for free, which is always good. Also, if it is bundled with the standard distribution, there is one less PECL package to get into account for automated machine deploys. However, if you are using APC as local storage in your application, I don&rsquo;t think the performance boost is worth if we&rsquo;re losing the easy caching that APC provides.</li><li>As <strong>Lukas Smith</strong> states in his comment, there is some work being done with <strong>ApcU</strong> (which can be seen at <a href=https://github.com/krakjoe/apcu target=_blank><a href=https://github.com/krakjoe/apcu>https://github.com/krakjoe/apcu</a></a>) which will be APC minus the byte choice cache. If they make it, with the launch of PHP 5.5 we will have an optimizer bundled with PHP and we will still be able to install ApcU. This will allow us to benefit of the performance boost in ZO+ while not losing APC storage and upload files hook. It definitely seems PHP 5.5 will be another amazing version of our favorite language with Generators and Zend Optimizer+ being the biggest improvements!<br></li></ul><p>Please, feel free to add any comments to these tests!</p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Ricard Clau.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>