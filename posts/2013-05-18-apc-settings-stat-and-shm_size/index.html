<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>APC Settings: stat and shm_size - Ricard Clau</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1309891-8','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Ricard Clau" rel=home><div class="logo__item logo__text"><div class=logo__title>Ricard Clau</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about-me><span class=menu__text>About me</span></a></li><li class=menu__item><a class=menu__link href=/curriculum-vitae-en><span class=menu__text>CV</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>APC Settings: stat and shm_size</h1></header><figure class="post__thumbnail thumbnail"><img class=thumbnail__image src=/wp-content/uploads/2013/05/apc.png alt="APC Settings: stat and shm_size"></figure><div class="content post__content clearfix"><p>Most of you already know that <strong>APC</strong> is really important to <strong>boost PHP performance</strong>. It will probably be replaced in the next months / years by <strong>Zend Optimizer+</strong> but meanwhile it is important to know how to properly tweak this amazing PHP extension.</p><p>If we have a look at <a href=http://php.net/manual/en/apc.configuration.php>http://php.net/manual/en/apc.configuration.php</a> we will see in the first couple of lines that both <strong>stat</strong> and <strong>shm_size</strong> are the most important directives but most people seem to not know about them, and this is why I am writing this post. Yes, <strong>most sysadmins</strong> don&#8217;t even know that these settings exist and the big difference you can make playing with them.</p><ul><li><strong>shm_size</strong>: This is about how much memory will be reserved for APC. Please take into account that this memory is occupied both by your userland variables and by the opcode cache. So, the more PHP files your application has, the more memory you need. Thanks God, well thanks <strong>Rasmus</strong>, there is a PHP script to inspect how much memory we are actually using. You can grab it at <a href="http://svn.php.net/viewvc/pecl/apc/trunk/apc.php?view=markup">http://svn.php.net/viewvc/pecl/apc/trunk/apc.php?view=markup</a>. And of course, in modern big PHP applications, with lots of libraries, dependencies, frameworks, etc.. it should be set at least at 64M and probably at 128M. Just inspect it in your production servers and you will find the most appropiate value.</li><li><strong>stat</strong>: This setting is a really cool one. By default, every time we require a file in PHP, if it is stored in APC, it looks at the <strong>filesystem</strong> stat to <strong>see if the file has changed</strong> to load a new version in memory. Of course, this is really inefficient and it is much better to <strong>set apc.stat to Off</strong>. This way <strong>you can literally rm your application folder</strong> and all files cached in APC will still work! Of course, this also helps doing deploys even in big traffic moments. The only drawback is that you need to wipe APC (via Apache reload or similar) after every deploy so that the new code actually is installed. But the benefits are far more interesting that this minor drawback! And I honestly hope you are no longer editing remote files with Vim to quick fix Friday afternoon bugs ðŸ™‚</li></ul><p>So, quite a short post, but I think it is worth it, provided there are already quite a bunch of companies where I had to fix this!</p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Ricard Clau.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>