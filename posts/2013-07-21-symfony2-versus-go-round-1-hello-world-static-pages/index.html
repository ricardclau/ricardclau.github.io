<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Symfony2 versus Go: Round 1 - Hello world (static pages) - Ricard Clau</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1309891-8','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Ricard Clau" rel=home><div class="logo__item logo__text"><div class=logo__title>Ricard Clau</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about-me><span class=menu__text>About me</span></a></li><li class=menu__item><a class=menu__link href=/curriculum-vitae-en><span class=menu__text>CV</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Symfony2 versus Go: Round 1 - Hello world (static pages)</h1></header><div class="content post__content clearfix"><p>In my new job at <a href=http://www.hailocab.com>Hailo</a> we are introducing <strong>Go</strong> as the main language in the new architecture and because of that I have started playing with it. Besides that, there has been a lot of comments and opinions in both the <strong>Symfony2</strong> and the <strong>PHP</strong> community regarding the <a href=http://www.techempower.com/benchmarks/ title="TechEmpower framework benchmarks" target=_blank>TechEmpower framework benchmarks</a> where Symfony2 appears at the bottom of the list for most of the tests.</p><p>Needless to say, <strong>PHP is and will always be slower than a compiled new-generation language</strong>. If it was faster&hellip; something would be absolutely wrong&hellip; but is this speed difference valuable? Most people will talk about the amount of servers you could save&hellip; and this is absolutely true. However, engineers able to develop applications in languages as <strong>Go</strong> or <strong>Scala</strong> are definitely more expensive and scarce so this is a cost and a risk to be taken into account as well.</p><p>Apart from that, <strong>comparing Symfony2 with Go is an absolute unfair and somehow even stupid comparison</strong>. Symfony2 is a full-stack PHP framework and because of that, it runs inside an existing web server as a module (being Apache, Nginx/PHP-FPM, etc) while with Go, we create a web-server within the code. So, it is comparing apples with bananas, but still, people like benchmarks, so there we go.</p><p>My whole idea for these series is to be able to somehow benchmark the difference if we decide to switch part of the application from PHP to Go (for instance, some slow API, some heavy calculation endpoint, etc&hellip;) and one of the easiest ways to do it without changing a lot of things is to use Apache mod_proxy extension to redirect some HTTP calls to a different port where Go would be listening. Of course, in a production environment, this would be done in some HTTP Load Balancer on top of our application, that might be Apache, Nginx, or other available options.</p><p>In our experiment, we will end up with these 2 urls: <a href=http://localhost/hello-php>http://localhost/hello-php</a> and <a href=http://localhost/hello-go>http://localhost/hello-go</a>. There will be Apache serving both but for the second one we will proxy the Request to another port where Go is listening. And this can be easily done with these lines in our VirtualHost configuration:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">1</span>    ProxyPreserveHost on
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">2</span>    ProxyPass /hello-go http://localhost:8080/hello</code></pre></div><p>And to build a simple hello world in Go, that listens on port 8080:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 1</span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span> 
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 3</span><span style=color:#f92672>import</span> (
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 4</span>    <span style=color:#e6db74>&#34;net/http&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 5</span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 6</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 7</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 8</span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>hello</span>(<span style=color:#a6e22e>w</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ResponseWriter</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Request</span>) {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 9</span>      <span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>Header</span>().<span style=color:#a6e22e>Set</span>(<span style=color:#e6db74>&#34;Content-Type&#34;</span>, <span style=color:#e6db74>&#34;text/html&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">10</span>      <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Fprint</span>(<span style=color:#a6e22e>w</span>, <span style=color:#e6db74>&#34;Hello world, from Go!&#34;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">11</span>}  
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">12</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">13</span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">14</span>    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>HandleFunc</span>(<span style=color:#e6db74>&#34;/hello&#34;</span>, <span style=color:#a6e22e>hello</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">15</span>    <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>ListenAndServe</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>, <span style=color:#66d9ef>nil</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">16</span>}</code></pre></div><p>And a Hello world in Symfony2 is something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 1</span><span style=color:#75715e>&lt;?php</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 3</span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>Ricardclau\SymfonyVsGoBundle\Controller</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 5</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Bundle\FrameworkBundle\Controller\Controller</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 6</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Sensio\Bundle\FrameworkExtraBundle\Configuration\Route</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 7</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\HttpFoundation\Response</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 8</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 9</span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DefaultController</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>Controller</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">10</span>{
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">11</span>    <span style=color:#e6db74>/**
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">12</span><span style=color:#e6db74>     * @Route(&#34;/hello-php&#34;)
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">13</span><span style=color:#e6db74>     */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">14</span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>indexAction</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">15</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">16</span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>&#39;Hello world, from PHP!&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">17</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">18</span>}
</code></pre></div><p>And if we use <strong>Apache Benchmark</strong> tool to benchmark the difference vs both calls we will get that our Symfony2 application is able to serve about <strong>230 req/s</strong> and our Go endpoint can serve about <strong>6300 req/s</strong>!.</p><p>So, for this particular case, without databases and not heavy business logic, Go is <strong>about 30 times faster</strong> than Symfony2. Pretty amazing, isn´t it? Let´s switch to Go? Well, let´s think about it a little bit.</p><p>If we were in a production environment, with a heavy traffic website, would we be serving static pages with PHP? Absolutely not! We would put Varnish or some other reverse proxy cache layer in front of our application! So, this difference is absolutely useless in real world applications! Of course, if you are confident with Go, you can develop your website entirely in Go and save some CPU cycles (and perhaps, even the Varnish setup) but again, if you are a CEO or the average Joe CTO who need to hire developers it is more likely that you can get 20 engineers with proper skills in PHP / Apache / Varnish than in Go.</p><p>To me, in this first experiment, the conclusion would be that for this case, switching to faster languages in absolutely worthless&hellip; but, what do you think about these numbers? In the following chapter of the series we will compare both stacks with database &ldquo;select&rdquo; queries and applications with intensive writing POST HTTP requests, so stay tuned for more crazy and perhaps stupid benchmarks!</p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Ricard Clau.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>