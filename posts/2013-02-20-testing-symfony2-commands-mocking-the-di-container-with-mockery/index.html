<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Testing Symfony2 Commands - Mocking the DI Container with Mockery - Ricard Clau</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-1309891-8','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title="Ricard Clau" rel=home><div class="logo__item logo__text"><div class=logo__title>Ricard Clau</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/about-me><span class=menu__text>About me</span></a></li><li class=menu__item><a class=menu__link href=/curriculum-vitae-en><span class=menu__text>CV</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Testing Symfony2 Commands - Mocking the DI Container with Mockery</h1></header><div class="content post__content clearfix"><p>Some months ago I had the pleasure to contribute to <a href=https://github.com/thobbs/phpcassa>phpcassa</a> library, maintained by <strong>Tyler Hobbs</strong>, adding support for <strong>Composer</strong> and <strong>Travis</strong>, and fixing some issues with PHP5.4 and some E_STRICT warnings.</p><p>And, as there is no <strong>Symfony2</strong> bundle for <strong>Cassandra</strong> yet, I have decided to create one myself. The bundle is at early stages but I have already developed some basic Administration commands, mainly to create a Keyspace, a ColumnFamily, etc&hellip; and I have decided to share here how I have unit-tested those commands.</p><p>Let&#8217;s be honest, <strong>PHPUnit</strong> is the de-facto standard for <strong>Unit Testing</strong>, we owe a lot to this amazing library but its mocking framework is a bit cumbersome and limited. And because of that, I&#8217;ve been using <a href=https://github.com/padraic/mockery>Mockery</a> for some time and I am pretty happy about it.</p><p>So, let&#8217;s see how can unit test a <strong>Symfony2 Command</strong> with the help of <strong>Mockery</strong>! Let&#8217;s forget about pure TDD, we will start showing the Create Keyspace Command and afterwards we will see how to test it.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 1</span><span style=color:#75715e>&lt;?php</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 3</span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>ADR\Bundle\CassandraBundle\Command</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 5</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Bundle\FrameworkBundle\Command\ContainerAwareCommand</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 6</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Input\InputInterface</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 7</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Output\OutputInterface</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 8</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Input\InputArgument</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 9</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>phpcassa\SystemManager</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">10</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">11</span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CassandraCreateKeyspaceCommand</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>ContainerAwareCommand</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">12</span>{
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">13</span>    <span style=color:#e6db74>/**
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">14</span><span style=color:#e6db74>     * @var \Symfony\Component\Console\Input\InputInterface
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">15</span><span style=color:#e6db74>     */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">16</span>    <span style=color:#66d9ef>private</span> $input;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">17</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">18</span>    <span style=color:#e6db74>/**
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">19</span><span style=color:#e6db74>     *
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">20</span><span style=color:#e6db74>     * @var \Symfony\Component\Console\Output\OutputInterface
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">21</span><span style=color:#e6db74>     */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">22</span>    <span style=color:#66d9ef>private</span> $output;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">23</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">24</span>    <span style=color:#e6db74>/**
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">25</span><span style=color:#e6db74>     * {@inheritDoc}
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">26</span><span style=color:#e6db74>     */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">27</span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>configure</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">28</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">29</span>        <span style=color:#66d9ef>parent</span><span style=color:#f92672>::</span><span style=color:#a6e22e>configure</span>();
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">30</span>        $this
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">31</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#39;cassandra:keyspace:create&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">32</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setDescription</span>(<span style=color:#e6db74>&#39;Creates the configured keyspace in selected cluster&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">33</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addArgument</span>(<span style=color:#e6db74>&#39;client&#39;</span>, <span style=color:#a6e22e>InputArgument</span><span style=color:#f92672>::</span><span style=color:#a6e22e>REQUIRED</span>, <span style=color:#e6db74>&#39;The client name in Symfony2 where keyspace will be created&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">34</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>addArgument</span>(<span style=color:#e6db74>&#39;keyspace&#39;</span>, <span style=color:#a6e22e>InputArgument</span><span style=color:#f92672>::</span><span style=color:#a6e22e>REQUIRED</span>, <span style=color:#e6db74>&#39;The keyspace name&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">35</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setHelp</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#a6e22e>EOT</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">36</span><span style=color:#a6e22e>The</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#a6e22e>info</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>cassandra</span><span style=color:#f92672>:</span><span style=color:#a6e22e>keyspace</span><span style=color:#f92672>:</span><span style=color:#a6e22e>create</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#f92672>/</span><span style=color:#a6e22e>info</span><span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>command</span> <span style=color:#a6e22e>creates</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>configured</span> <span style=color:#a6e22e>keyspace</span> <span style=color:#a6e22e>in</span> <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>selected</span> <span style=color:#a6e22e>cluster</span><span style=color:#f92672>.</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">37</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">38</span><span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#a6e22e>info</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>app</span><span style=color:#f92672>/</span><span style=color:#a6e22e>console</span> <span style=color:#a6e22e>cassandra</span><span style=color:#f92672>:</span><span style=color:#a6e22e>keyspace</span><span style=color:#f92672>:</span><span style=color:#a6e22e>create</span> [<span style=color:#a6e22e>client</span>] [<span style=color:#a6e22e>keyspace</span>]<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>lt</span>;<span style=color:#f92672>/</span><span style=color:#a6e22e>info</span><span style=color:#f92672>&gt;</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">39</span><span style=color:#a6e22e>EOT</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">40</span>            );
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">41</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">42</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">43</span>    <span style=color:#e6db74>/**
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">44</span><span style=color:#e6db74>     * {@inheritDoc}
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">45</span><span style=color:#e6db74>     */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">46</span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>InputInterface</span> $input, <span style=color:#a6e22e>OutputInterface</span> $output)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">47</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">48</span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>input</span> <span style=color:#f92672>=</span> $input;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">49</span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>output</span> <span style=color:#f92672>=</span> $output;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">50</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">51</span>        $keyspace <span style=color:#f92672>=</span> $input<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getArgument</span>(<span style=color:#e6db74>&#39;keyspace&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">52</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">53</span>        $manager <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getContainer</span>()<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;cassandra.&#39;</span> <span style=color:#f92672>.</span> $input<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getArgument</span>(<span style=color:#e6db74>&#39;client&#39;</span>) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.manager&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">54</span>        $manager<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>create_keyspace</span>($keyspace, <span style=color:#66d9ef>array</span>());
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">55</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">56</span>        $output<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>writeln</span>(<span style=color:#e6db74>&#39;&amp;lt;info&gt;Keyspace &#39;</span> <span style=color:#f92672>.</span> $keyspace <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39; successfully created at &#39;</span> <span style=color:#f92672>.</span> $manager<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getServer</span>() <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;&amp;lt;/info&gt;&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">57</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">58</span>}
</code></pre></div><p>In this bundle, via its <strong>Dependency Injection Extension</strong> file, a <strong>&#8216;cassandra.xxx.manager&#8217;</strong> service is created (being xxx how we are naming that cassandra cluster) and this service is basically a wrapper for <strong>phpcassa\SystemManager</strong> class. Details on how to do it can be found <a href=https://github.com/amigos-del-rigor/ADRCassandraBundle/blob/master/DependencyInjection/ADRCassandraExtension.php>here</a></p><p>But how can we unit test this command? Lots of widely used bundles do not test commands and yes, to be honest, testing this does not add big value but it can still work for a small <strong>Container mocking</strong> example.</p><p>So, to unit test the command, we could do something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 1</span><span style=color:#75715e>&lt;?php</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 2</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 3</span><span style=color:#66d9ef>namespace</span> <span style=color:#a6e22e>ADR\Bundle\CassandraBundle\Tests\Command</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 4</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 5</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Application</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 6</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>ADR\Bundle\CassandraBundle\Command\CassandraCreateKeyspaceCommand</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 7</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Symfony\Component\Console\Tester\CommandTester</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 8</span><span style=color:#66d9ef>use</span> <span style=color:#a6e22e>Mockery</span> <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>m</span>;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79"> 9</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">10</span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CassandraCreateKeyspaceCommandTest</span> <span style=color:#66d9ef>extends</span> <span style=color:#a6e22e>\PHPUnit_Framework_TestCase</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">11</span>{
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">12</span>    <span style=color:#e6db74>/**
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">13</span><span style=color:#e6db74>     * @dataProvider getNonInteractiveData
</span><span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">14</span><span style=color:#e6db74>     */</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">15</span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>testCreateKeyspaceCommand</span>($input)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">16</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">17</span>        $application <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Application</span>();
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">18</span>        $application<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CassandraCreateKeyspaceCommand</span>());
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">19</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">20</span>        $command <span style=color:#f92672>=</span> $application<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>find</span>(<span style=color:#e6db74>&#39;cassandra:keyspace:create&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">21</span>        $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>setContainer</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getMockContainer</span>($input));
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">22</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">23</span>        $tester <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>CommandTester</span>($command);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">24</span>        $tester<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>execute</span>(
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">25</span>            <span style=color:#a6e22e>array_merge</span>(<span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;command&#39;</span> <span style=color:#f92672>=&gt;</span> $command<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getName</span>()), $input)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">26</span>        );
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">27</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">28</span>        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>assertEquals</span>(<span style=color:#e6db74>&#39;Keyspace &#39;</span> <span style=color:#f92672>.</span> $input[<span style=color:#e6db74>&#39;keyspace&#39;</span>] <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39; successfully created at #mockServer#&#39;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>PHP_EOL</span>, $tester<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getDisplay</span>());
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">29</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">30</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">31</span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getMockContainer</span>($input)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">32</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">33</span>        $systemManager <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span><span style=color:#f92672>::</span><span style=color:#a6e22e>mock</span>(<span style=color:#e6db74>&#39;phpcassa\SystemManager&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">34</span>        $systemManager
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">35</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>shouldReceive</span>(<span style=color:#e6db74>&#39;create_keyspace&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">36</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>once</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">37</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>with</span>($input[<span style=color:#e6db74>&#39;keyspace&#39;</span>], <span style=color:#66d9ef>array</span>())
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">38</span>        ;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">39</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">40</span>        $systemManager
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">41</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>shouldReceive</span>(<span style=color:#e6db74>&#39;getServer&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">42</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>once</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">43</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>withNoArgs</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">44</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>andReturn</span>(<span style=color:#e6db74>&#39;#mockServer#&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">45</span>        ;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">46</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">47</span>        $container <span style=color:#f92672>=</span> <span style=color:#a6e22e>m</span><span style=color:#f92672>::</span><span style=color:#a6e22e>mock</span>(<span style=color:#e6db74>&#39;Symfony\Component\DependencyInjection\Container&#39;</span>);
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">48</span>        $container
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">49</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>shouldReceive</span>(<span style=color:#e6db74>&#39;get&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">50</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>once</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">51</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>with</span>(<span style=color:#e6db74>&#39;cassandra.&#39;</span> <span style=color:#f92672>.</span> $input[<span style=color:#e6db74>&#39;client&#39;</span>] <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;.manager&#39;</span>)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">52</span>            <span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>andReturn</span>($systemManager)
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">53</span>        ;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">54</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">55</span>        <span style=color:#66d9ef>return</span> $container;
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">56</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">57</span>
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">58</span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getNonInteractiveData</span>()
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">59</span>    {
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">60</span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>array</span>(
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">61</span>            <span style=color:#66d9ef>array</span>(<span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;keyspace&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;fooKeySpace&#39;</span>, <span style=color:#e6db74>&#39;client&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;barClient&#39;</span>)),
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">62</span>        );
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">63</span>    }
<span style="margin-right:.4em;padding:0 .4em;color:#7c7c79">64</span>}
</code></pre></div><p>The most interesting part is that we create a mocked <strong>phpcassa\SystemManager</strong> and a mocked <strong>Symfony\Component\DependencyInjection\Container</strong> with the calls and responses we expect from them.</p><p>As you can see, Mockery&#8217;s fluent interface seems to be more clear and intuitive than PHPUnit and makes it easier to test Symfony2 commands!</p><p>I hope you&#8217;ve liked this example and I promise to blog more often than these latest months!</p></div></article></main></div></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2021 Ricard Clau.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>